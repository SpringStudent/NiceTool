!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("jQuery"),require("CodeMirror")):"function"==typeof define&&define.amd?define("mergely",["jQuery","CodeMirror"],e):"object"==typeof exports?exports.mergely=e(require("jQuery"),require("CodeMirror")):t.mergely=e(t.jQuery,t.CodeMirror)}(window,function(i,s){return n=[function(t,e,i){"use strict";!function(E,f){var V={};V.ChangeExpression=new RegExp(/(^(?![><\-])*\d+(?:,\d+)?)([acd])(\d+(?:,\d+)?)/);var j=i(1);V.DiffParser=function(t){for(var e,i,s,r=[],n=0,h=t.split(/\n/),o=0;o<h.length;++o)0!=h[o].length&&(e={},null!=(i=V.ChangeExpression.exec(h[o]))&&(s=i[1].split(","),e["lhs-line-from"]=s[0]-1,1==s.length?e["lhs-line-to"]=s[0]-1:e["lhs-line-to"]=s[1]-1,s=i[3].split(","),e["rhs-line-from"]=s[0]-1,1==s.length?e["rhs-line-to"]=s[0]-1:e["rhs-line-to"]=s[1]-1,e.op=i[2],r[n++]=e));return r},V.sizeOf=function(t){var e,i=0;for(e in t)t.hasOwnProperty(e)&&i++;return i},V.LCS=function(t,e,i){this.x=t&&t.replace(/[ ]{1}/g,"\n")||"",this.y=e&&e.replace(/[ ]{1}/g,"\n")||"",this.options=i},E.extend(V.LCS.prototype,{clear:function(){this.ready=0},diff:function(t,e){for(var i=new V.diff(this.x,this.y,{ignorews:!1,ignoreaccents:!!this.options.ignoreaccents}),s=V.DiffParser(i.normal_form()),r=0,n=0,h=0;h<s.length;++h){var o,l=s[h];"a"!=l.op&&(r=i.getLines("lhs").slice(0,l["lhs-line-from"]).join(" ").length,n=l["lhs-line-to"]+1,o=i.getLines("lhs").slice(l["lhs-line-from"],n).join(" "),"d"==l.op?o+=" ":0<r&&"c"==l.op&&(r+=1),e(r,r+o.length)),"d"!=l.op&&(r=i.getLines("rhs").slice(0,l["rhs-line-from"]).join(" ").length,n=l["rhs-line-to"]+1,o=i.getLines("rhs").slice(l["rhs-line-from"],n).join(" "),"a"==l.op?o+=" ":0<r&&"c"==l.op&&(r+=1),t(r,r+o.length))}}}),V.CodeifyText=function(t){this._max_code=0,this._diff_codes={},this.ctxs={},E.extend(this,t),this.lhs=t.lhs.split("\n"),this.rhs=t.rhs.split("\n")},E.extend(V.CodeifyText.prototype,{getCodes:function(t){var e;return this.ctxs.hasOwnProperty(t)||(e=this._diff_ctx(this[t]),(this.ctxs[t]=e).codes.length=Object.keys(e.codes).length),this.ctxs[t].codes},getLines:function(t){return this.ctxs[t].lines},_diff_ctx:function(t){var e={i:0,codes:{},lines:t};return this._codeify(t,e),e},_codeify:function(t,e){this._max_code;for(var i=0;i<t.length;++i){var s=t[i];this.options.ignorews&&(s=s.replace(/\s+/g,"")),this.options.ignorecase&&(s=s.toLowerCase()),this.options.ignoreaccents&&(s=s.normalize("NFD").replace(/[\u0300-\u036f]/g,""));var r=this._diff_codes[s];null!=r?e.codes[i]=r:(this._max_code++,this._diff_codes[s]=this._max_code,e.codes[i]=this._max_code)}}}),V.diff=function(t,e,i){i=E.extend({ignorews:!1,ignoreaccents:!1},i);this.codeify=new V.CodeifyText({lhs:t,rhs:e,options:i});e={codes:this.codeify.getCodes("lhs"),modified:{}},i={codes:this.codeify.getCodes("rhs"),modified:{}};e.codes.length,i.codes.length,this._lcs(e,0,e.codes.length,i,0,i.codes.length,[],[]),this._optimize(e),this._optimize(i),this.items=this._create_diffs(e,i)},E.extend(V.diff.prototype,{changes:function(){return this.items},getLines:function(t){return this.codeify.getLines(t)},normal_form:function(){for(var t="",e=0;e<this.items.length;++e){var i=this.items[e],s="c";0==i.lhs_deleted_count&&0<i.rhs_inserted_count?s="a":0<i.lhs_deleted_count&&0==i.rhs_inserted_count&&(s="d"),t+=(1==i.lhs_deleted_count?i.lhs_start+1:0==i.lhs_deleted_count?i.lhs_start:i.lhs_start+1+","+(i.lhs_start+i.lhs_deleted_count))+s+(1==i.rhs_inserted_count?i.rhs_start+1:0==i.rhs_inserted_count?i.rhs_start:i.rhs_start+1+","+(i.rhs_start+i.rhs_inserted_count))+"\n";var r=this.getLines("lhs"),n=this.getLines("rhs");if(n&&r){for(var h=i.lhs_start;h<i.lhs_start+i.lhs_deleted_count;++h)t+="< "+r[h]+"\n";for(i.rhs_inserted_count&&i.lhs_deleted_count&&(t+="---\n"),h=i.rhs_start;h<i.rhs_start+i.rhs_inserted_count;++h)t+="> "+n[h]+"\n"}}return t},_lcs:function(t,e,i,s,r,n,h,o){for(;e<i&&r<n&&t.codes[e]==s.codes[r];)++e,++r;for(;e<i&&r<n&&t.codes[i-1]==s.codes[n-1];)--i,--n;if(e==i)for(;r<n;)s.modified[r++]=!0;else if(r==n)for(;e<i;)t.modified[e++]=!0;else{var l=this._sms(t,e,i,s,r,n,h,o);this._lcs(t,e,l.x,s,r,l.y,h,o),this._lcs(t,l.x,i,s,l.y,n,h,o)}},_sms:function(t,e,i,s,r,n,h,o){var l=t.codes.length+s.codes.length+1,a=e-r,c=i-n,d=0!=(1&i-e-(n-r)),g=l-a,f=l-c,u=(i-e+n-r)/2+1;o[g+a+1]=e,h[f+c-1]=i;for(var p,m,_,y={x:0,y:0},v=0;v<=u;++v){for(p=a-v;p<=a+v;p+=2){for(p==a-v?m=o[g+p+1]:(m=o[g+p-1]+1,p<a+v&&o[g+p+1]>=m&&(m=o[g+p+1])),_=m-p;m<i&&_<n&&t.codes[m]==s.codes[_];)m++,_++;if(o[g+p]=m,d&&c-v<p&&p<c+v&&h[f+p]<=o[g+p])return y.x=o[g+p],y.y=o[g+p]-p,y}for(p=c-v;p<=c+v;p+=2){for(p==c+v?m=h[f+p-1]:(m=h[f+p+1]-1,c-v<p&&h[f+p-1]<m&&(m=h[f+p-1])),_=m-p;e<m&&r<_&&t.codes[m-1]==s.codes[_-1];)m--,_--;if(h[f+p]=m,!d&&a-v<=p&&p<=a+v&&h[f+p]<=o[g+p])return y.x=o[g+p],y.y=o[g+p]-p,y}}throw"the algorithm should never come here."},_optimize:function(t){for(var e=0,i=0;e<t.codes.length;){for(;e<t.codes.length&&(null==t.modified[e]||0==t.modified[e]);)e++;for(i=e;i<t.codes.length&&1==t.modified[i];)i++;i<t.codes.length&&t.codes[e]==t.codes[i]?(t.modified[e]=!1,t.modified[i]=!0):e=i}},_create_diffs:function(t,e){for(var i,s,r=[],n=0,h=0;n<t.codes.length||h<e.codes.length;)if(n<t.codes.length&&!t.modified[n]&&h<e.codes.length&&!e.modified[h])n++,h++;else{for(i=n,s=h;n<t.codes.length&&(h>=e.codes.length||t.modified[n]);)n++;for(;h<e.codes.length&&(n>=t.codes.length||e.modified[h]);)h++;(i<n||s<h)&&r.push({lhs_start:i,rhs_start:s,lhs_deleted_count:n-i,rhs_inserted_count:h-s})}return r}}),V.mergely=function(t,e){t&&this.init(t,e)},E.extend(V.mergely.prototype,{name:"mergely",init:function(t,e){this.diffView=new V.CodeMirrorDiffView(t,e),this.bind(t)},bind:function(t){this.diffView.bind(t)}}),V.CodeMirrorDiffView=function(t,e){f.defineExtension("centerOnCursor",function(){var t=this.cursorCoords(null,"local");this.scrollTo(null,(t.top+t.bottom)/2-this.getScrollerElement().clientHeight/2)}),this.init(t,e)},E.extend(V.CodeMirrorDiffView.prototype,{init:function(h,t){this.settings=E.extend(!0,{autoupdate:!0,autoresize:!0,rhs_margin:"right",wrap_lines:!1,line_numbers:!0,lcs:!0,sidebar:!0,viewport:!1,ignorews:!1,ignorecase:!1,ignoreaccents:!1,fadein:"fast",resize_timeout:500,change_timeout:150,fgcolor:{a:"#4ba3fa",c:"#a3a3a3",d:"#ff7f7f",ca:"#4b73ff",cc:"#434343",cd:"#ff4f4f"},bgcolor:"#eee",vpcolor:"rgba(0, 0, 200, 0.5)",license:"",width:"auto",height:"auto",cmsettings:{styleSelectedText:!0},lhs:function(t){},rhs:function(t){},loaded:function(){},resize:function(t){var e,i,s=E(h).parent(),r=(e="auto"==this.width?s.width():this.width)/2-16-8,n=i="auto"==this.height?s.height()-2:this.height,s=E(h);s.find(".mergely-column").css({width:r+"px"}),s.find(".mergely-column, .mergely-canvas, .mergely-margin, .mergely-column textarea, .CodeMirror-scroll, .cm-s-default").css({height:n+"px"}),s.find(".mergely-canvas").css({height:n+"px"}),s.find(".mergely-column textarea").css({width:r+"px"}),s.css({width:e,height:i,clear:"both"}),"none"===s.css("display")&&(0!=this.fadein?s.fadeIn(this.fadein):s.show()),this.resized&&this.resized()},_debug:"",resized:function(){}},t),this.element=E(h),this.lhs_cmsettings={lineWrapping:this.settings.wrap_lines,lineNumbers:this.settings.line_numbers},this.rhs_cmsettings={lineWrapping:this.settings.wrap_lines,lineNumbers:this.settings.line_numbers};var e=[];this.lhs_cmsettings.lineNumbers&&(e=["merge","CodeMirror-linenumbers"]);var i=[];this.rhs_cmsettings.lineNumbers&&(i=["merge","CodeMirror-linenumbers"]),E.extend(!0,this.lhs_cmsettings,this.settings.cmsettings,{gutters:e},this.settings.lhs_cmsettings),E.extend(!0,this.rhs_cmsettings,this.settings.cmsettings,{gutters:i},this.settings.rhs_cmsettings),this.element.bind("destroyed",E.proxy(this.teardown,this)),E.data(h,"mergely",this),this._setOptions(t)},unbind:function(){null!=this.changed_timeout&&clearTimeout(this.changed_timeout),this.editor[this.id+"-lhs"].toTextArea(),this.editor[this.id+"-rhs"].toTextArea(),E(window).off(".mergely")},destroy:function(){this.element.unbind("destroyed",this.teardown),this.teardown()},teardown:function(){this.unbind()},lhs:function(t){this.changes=[],this.editor[this.id+"-lhs"].setValue(t)},rhs:function(t){this.changes=[],this.editor[this.id+"-rhs"].setValue(t)},update:function(){this._changing(this.id+"-lhs",this.id+"-rhs")},unmarkup:function(){this._clear()},scrollToDiff:function(t){this.changes.length&&("next"==t?this._current_diff==this.changes.length-1?this._current_diff=0:this._current_diff=Math.min(++this._current_diff,this.changes.length-1):"prev"==t&&(0==this._current_diff?this._current_diff=this.changes.length-1:this._current_diff=Math.max(--this._current_diff,0)),this._scroll_to_change(this.changes[this._current_diff]),this._changed(this.id+"-lhs",this.id+"-rhs"))},mergeCurrentChange:function(t){this.changes.length&&("lhs"!=t||this.lhs_cmsettings.readOnly?"rhs"!=t||this.rhs_cmsettings.readOnly||this._merge_change(this.changes[this._current_diff],"lhs","rhs"):this._merge_change(this.changes[this._current_diff],"rhs","lhs"))},scrollTo:function(t,e){var i=this.editor[this.id+"-lhs"],s=this.editor[this.id+"-rhs"];"lhs"==t?(i.setCursor(e),i.centerOnCursor()):(s.setCursor(e),s.centerOnCursor())},_setOptions:function(t){var e,i;E.extend(this.settings,t),this.settings.hasOwnProperty("rhs_margin")&&("left"==this.settings.rhs_margin?this.element.find(".mergely-margin:last-child").insertAfter(this.element.find(".mergely-canvas")):(t=this.element.find(".mergely-margin").last()).appendTo(t.parent())),this.settings.hasOwnProperty("sidebar")&&(this.settings.sidebar?this.element.find(".mergely-margin").css({display:"block"}):this.element.find(".mergely-margin").css({display:"none"})),this.settings.hasOwnProperty("wrap_lines")&&this.editor&&(e=this.editor[this.id+"-lhs"],i=this.editor[this.id+"-rhs"],e.setOption("lineWrapping",this.settings.wrap_lines),i.setOption("lineWrapping",this.settings.wrap_lines)),this.settings.hasOwnProperty("line_numbers")&&this.editor&&(e=this.editor[this.id+"-lhs"],i=this.editor[this.id+"-rhs"],e.setOption("lineNumbers",this.settings.line_numbers),i.setOption("lineNumbers",this.settings.line_numbers))},options:function(t){if(!t)return this.settings;this._setOptions(t),this.settings.autoresize&&this.resize(),this.settings.autoupdate&&this.update()},swap:function(){var t,e,i;this.lhs_cmsettings.readOnly||this.rhs_cmsettings.readOnly||(t=this.editor[this.id+"-lhs"],i=(e=this.editor[this.id+"-rhs"]).getValue(),e.setValue(t.getValue()),t.setValue(i))},merge:function(t){var e=this.editor[this.id+"-lhs"],i=this.editor[this.id+"-rhs"];"lhs"!=t||this.lhs_cmsettings.readOnly?this.rhs_cmsettings.readOnly||i.setValue(e.getValue()):e.setValue(i.getValue())},summary:function(){return{numChanges:this.changes.length,lhsLength:this.editor[this.id+"-lhs"].getValue().length,rhsLength:this.editor[this.id+"-rhs"].getValue().length,c:this.changes.filter(function(t){return"c"===t.op}).length,a:this.changes.filter(function(t){return"a"===t.op}).length,d:this.changes.filter(function(t){return"d"===t.op}).length}},get:function(t){t=this.editor[this.id+"-"+t].getValue();return null==t?"":t},clear:function(t){"lhs"==t&&this.lhs_cmsettings.readOnly||"rhs"==t&&this.rhs_cmsettings.readOnly||this.editor[this.id+"-"+t].setValue("")},cm:function(t){return this.editor[this.id+"-"+t]},search:function(t,e,i){var s=this.editor[this.id+"-lhs"],r=this.editor[this.id+"-rhs"];i="prev"==i?"findPrevious":"findNext",0!=(r="lhs"==t?s:r).getSelection().length&&this.prev_query[t]==e||(this.cursor[this.id]=r.getSearchCursor(e,{line:0,ch:0},!1),this.prev_query[t]=e);t=this.cursor[this.id];t[i]()?r.setSelection(t.from(),t.to()):t=r.getSearchCursor(e,{line:0,ch:0},!1)},resize:function(){this.settings.resize(),this._changing(this.id+"-lhs",this.id+"-rhs"),this._set_top_offset(this.id+"-lhs")},diff:function(){var t=this.editor[this.id+"-lhs"].getValue(),e=this.editor[this.id+"-rhs"].getValue();return new V.diff(t,e,this.settings).normal_form()},bind:function(t){var e=this;this.trace("init","bind"),this.element.hide(),this.id=E(t).attr("id");try{E("#".concat(this.id))}catch(t){return void console.error("jQuery failed to find mergely: #".concat(this.id))}this.changed_timeout=null,this.chfns={},this.chfns[this.id+"-lhs"]=[],this.chfns[this.id+"-rhs"]=[],this.prev_query=[],this.cursor=[],this._skipscroll={},this.change_exp=new RegExp(/(\d+(?:,\d+)?)([acd])(\d+(?:,\d+)?)/),s=null!=E.button?(r='<button title="Merge left"></button>','<button title="Merge right"></button>'):(r='<div style="'+(i="opacity:0.6;height:16px;background-color:#bfbfbf;cursor:pointer;text-align:center;color:#eee;border:1px solid #848484;margin-right:-15px;margin-top:-2px;")+'" title="Merge left">&lt;</div>','<div style="'+i+'" title="Merge right">&gt;</div>'),this.merge_rhs_button=E(s),this.merge_lhs_button=E(r);var t=E('<div id="mergely-splash">'),i=E('<div class="mergely-margin" style="height: \''.concat("10px",'\'"><canvas id="lhs-margin" width="8px" height="\'').concat("10px","'\"></canvas></div>"));i.find("#lhs-margin").attr("id","".concat(this.id,"-lhs-margin"));var s=E("<div style=\"position:relative;width:'".concat("10px","'; height:'").concat("10px",'\'" id="editor-lhs" class="mergely-column"><textarea id="text-lhs"></textarea></div>'));s.eq(0).attr("id","".concat(this.id,"-editor-lhs")),s.find("#text-lhs").attr("id","".concat(this.id,"-lhs"));var r=E('<div class="mergely-canvas" style="height: \''.concat("10px",'\'"><canvas id="lhs-rhs-canvas" style="width:28px" width="28px" height="\'').concat("10px","'\"></canvas></div>"));r.find("#mergely-canvas").attr("id","".concat(this.id,"-mergely-canvas")),r.find("#lhs-rhs-canvas").attr("id","".concat(this.id,"-lhs-").concat(this.id,"-rhs-canvas")),this.element.append(t),this.element.append(i),this.element.append(s),this.element.append(r);s=E('<div class="mergely-margin" style="height: \''.concat("10px",'\'"><canvas id="rhs-margin" width="8px" height="\'').concat("10px","'\"></canvas></div>"));s.find("#rhs-margin").attr("id","".concat(this.id,"-rhs-margin")),"left"==this.settings.rhs_margin&&this.element.append(s);var n,h,o,l,a,c,r=E("<div style=\"width:'".concat("10px","'; height:'").concat("10px",'\'" id="editor-rhs" class="mergely-column"><textarea id="text-rhs"></textarea></div>'));r.eq(0).attr("id","".concat(this.id,"-editor-rhs")),r.find("#text-rhs").attr("id","".concat(this.id,"-rhs")),this.element.append(r),"left"!=this.settings.rhs_margin&&this.element.append(s),this.settings.sidebar||this.element.find(".mergely-margin").css({display:"none"}),["lgpl-separate-notice","gpl-separate-notice","mpl-separate-notice","commercial"].indexOf(this.settings.license)<0&&(o=(o=(s={lgpl:"GNU LGPL v3.0",gpl:"GNU GPL v3.0",mpl:"MPL 1.1"})[this.settings.license])||s.lgpl,this.element.parent().height(),s=this.element.parent().width(),this.element.find("#mergely-splash").css({position:"absolute",zIndex:"100",backgroundColor:"#fff",border:"1px solid black",height:"70px",width:"300px",left:(s-300)/2,padding:"10px 10px 0 10px",fontFamily:"arial",fontSize:"11px"}).append('<p><img width="36" height="36" alt="mergely" src="data:image/png;base64,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" style="float:left;padding-right:10px;" />This software is a Combined Work using Mergely and is covered by the '+o+' license.  For the full license, see <a target="_blank" href="http://www.mergely.com">http://www.mergely.com/license.</a></p>'),E("body").one("click",function(){E("#mergely-splash").fadeOut(100,"linear",function(){E("#mergely-splash").remove()})}));try{n=this.element.find("#".concat(this.id,"-rhs")).get(0)}catch(t){}if(n){try{h=this.element.find("#".concat(this.id,"-lhs")).get(0)}catch(t){}h?(o=E('<div style="display:none" class="mergely current start" />').appendTo("body").css("border-top-color"),this.current_diff_color=o,o="#".concat(this.id," .CodeMirror-gutter-text { padding: 5px 0 0 0; }\n\t\t\t'#").concat(this.id," .CodeMirror-lines pre, #").concat(this.id," .CodeMirror-gutter-text pre { line-height: 18px; }\n\t\t\t'.CodeMirror-linewidget { overflow: hidden; };"),this.settings.autoresize&&(o+="".concat(this.id," .CodeMirror-scroll { height: 100%; overflow: auto; }")),E('<style type="text/css">'.concat(o+="\n.CodeMirror { line-height: 18px; }","</style>")).appendTo("head"),(l=this).trace("init","binding event listeners"),this.editor=[],this.editor[this.id+"-lhs"]=f.fromTextArea(h,this.lhs_cmsettings),this.editor[this.id+"-rhs"]=f.fromTextArea(n,this.rhs_cmsettings),this.editor[this.id+"-lhs"].on("change",function(){l.settings.autoupdate&&l._changing(l.id+"-lhs",l.id+"-rhs")}),this.editor[this.id+"-lhs"].on("scroll",function(){l._scrolling(l.id+"-lhs")}),this.editor[this.id+"-rhs"].on("change",function(){l.settings.autoupdate&&l._changing(l.id+"-lhs",l.id+"-rhs")}),this.editor[this.id+"-rhs"].on("scroll",function(){l._scrolling(l.id+"-rhs")}),this.settings.autoresize&&(a=null,c=function(t){l.settings.resize&&l.settings.resize(t),l.editor[l.id+"-lhs"].refresh(),l.editor[l.id+"-rhs"].refresh()},E(window).on("resize.mergely",function(){a&&clearTimeout(a),a=setTimeout(c,l.settings.resize_timeout)}),c(!0)),this.editor[this.id+"-lhs"].on("gutterClick",function(t,e,i,s){d.call(this,"lhs",e,s)}.bind(this)),this.editor[this.id+"-rhs"].on("gutterClick",function(t,e,i,s){d.call(this,"rhs",e,s)}.bind(this)),this.settings.lhs&&(l.trace("init","setting lhs value"),this.settings.lhs(function(t){this._initializing=!0,this.editor[this.id+"-lhs"].getDoc().setValue(t)}.bind(this))),this.settings.rhs&&(l.trace("init","setting rhs value"),this.settings.rhs(function(t){this._initializing=!0,this.editor[this.id+"-rhs"].getDoc().setValue(t)}.bind(this))),this.element.one("updated",function(){e._initializing=!1,l.settings.loaded&&l.settings.loaded()}),this.trace("init","bound"),this.editor[this.id+"-lhs"].focus()):console.error("lhs textarea not defined - Mergely not initialized properly")}else console.error("rhs textarea not defined - Mergely not initialized properly");function d(t,e,i){var s,r;if(!(i.target&&0<E(i.target).closest(".merge-button").length))for(s=0;s<this.changes.length;s++)if(e>=(r=this.changes[s])[t+"-line-from"]&&e<=r[t+"-line-to"]){this._current_diff=s,setTimeout(function(){this.scrollToDiff()}.bind(this),10);break}}},_scroll_to_change:function(t){var e,i;t&&(e=this.editor[this.id+"-lhs"],i=this.editor[this.id+"-rhs"],e.setCursor(Math.max(t["lhs-line-from"],0),0),i.setCursor(Math.max(t["rhs-line-from"],0),0),0<=t["lhs-line-to"]&&e.scrollIntoView({line:t["lhs-line-to"]}),e.focus())},_scrolling:function(t){if(!0!==this._skipscroll[t]){if(this.changes){var e=E(this.editor[t].getScrollerElement());null==this.midway&&(this.midway=(e.height()/2+e.offset().top).toFixed(2));var i=this.editor[t].coordsChar({left:0,top:this.midway}),s=e.scrollTop(),r=e.scrollLeft();this.trace("scroll","side",t),this.trace("scroll","midway",this.midway),this.trace("scroll","midline",i),this.trace("scroll","top_to",s),this.trace("scroll","left_to",r);var n,h=this.id+"-lhs",o=this.id+"-rhs";for(n in this.editor)if(this.editor.hasOwnProperty(n)&&t!=n){for(var l=t.replace(this.id+"-",""),a=n.replace(this.id+"-",""),c=0,d=null,g=!1,f=0;f<this.changes.length;++f){var u=this.changes[f];i.line>=u[l+"-line-from"]&&(i.line>=(d=u)[l+"-line-to"]&&(u.hasOwnProperty(l+"-y-start")&&u.hasOwnProperty(l+"-y-end")&&u.hasOwnProperty(a+"-y-start")&&u.hasOwnProperty(a+"-y-end")?c+=u[l+"-y-end"]-u[l+"-y-start"]-(u[a+"-y-end"]-u[a+"-y-start"]):g=!0))}var p=this.editor[n].getViewport(),m=!0;d&&(this.trace("scroll","last change before midline",d),i.line>=p.from&&i<=p.to&&(m=!1)),this.trace("scroll","scroll",m),m||g?(this.trace("scroll","scrolling other side",s-c),this._skipscroll[n]=!0,this.editor[n].scrollTo(r,s-c)):this.trace("scroll","not scrolling other side"),this.settings.autoupdate&&(j.start(),this._calculate_offsets(h,o,this.changes),this.trace("change","offsets time",j.stop()),this._markup_changes(h,o,this.changes),this.trace("change","markup time",j.stop()),this._draw_diff(h,o,this.changes),this.trace("change","draw time",j.stop())),this.trace("scroll","scrolled")}}}else this._skipscroll[t]=!1},_changing:function(t,e){this.trace("change","changing-timeout",this.changed_timeout);var i=this;null!=this.changed_timeout&&clearTimeout(this.changed_timeout),this.changed_timeout=setTimeout(function(){j.start(),i._changed(t,e),i.trace("change","total time",j.stop())},this.settings.change_timeout)},_changed:function(t,e){this._clear(),this._diff(t,e)},_clear:function(){function t(){for(j.start(),r=0,h=i.lineCount();r<h;++r)i.removeLineClass(r,"background");for(r=0;r<s.length;++r)(n=s[r]).lines.length&&o.trace("change","clear text",n.lines[0].text),n.clear();i.clearGutter("merge"),o.trace("change","clear time",j.stop())}var e,i,s,r,n,h,o=this;for(e in this.editor)this.editor.hasOwnProperty(e)&&(i=this.editor[e],s=o.chfns[e],i.operation(t));o.chfns[e]=[];var l=this._draw_info(this.id+"-lhs",this.id+"-rhs"),a=l.clhs.get(0).getContext("2d"),c=l.crhs.get(0).getContext("2d"),d=l.dcanvas.getContext("2d");a.beginPath(),a.fillStyle=this.settings.bgcolor,a.strokeStyle="#888",a.fillRect(0,0,6.5,l.visible_page_height),a.strokeRect(0,0,6.5,l.visible_page_height),c.beginPath(),c.fillStyle=this.settings.bgcolor,c.strokeStyle="#888",c.fillRect(0,0,6.5,l.visible_page_height),c.strokeRect(0,0,6.5,l.visible_page_height),d.beginPath(),d.fillStyle="#fff",d.fillRect(0,0,this.draw_mid_width,l.visible_page_height)},_diff:function(t,e){var i=this.editor[t].getValue(),s=this.editor[e].getValue();j.start();s=new V.diff(i,s,this.settings);this.trace("change","diff time",j.stop()),this.changes=V.DiffParser(s.normal_form()),this.trace("change","parse time",j.stop()),void 0===this._current_diff&&this.changes.length&&(this._current_diff=0,this._initializing&&this._scroll_to_change(this.changes[0])),this.trace("change","scroll_to_change time",j.stop()),this._calculate_offsets(t,e,this.changes),this.trace("change","offsets time",j.stop()),this._markup_changes(t,e,this.changes),this.trace("change","markup time",j.stop()),this._draw_diff(t,e,this.changes),this.trace("change","draw time",j.stop()),this.element.trigger("updated")},_parse_diff:function(t,e,i){this.trace("diff","diff results:\n",i);for(var s,r,n,h=[],o=0,l=i.split(/\n/),a=0;a<l.length;++a)0!=l[a].length&&(s={},null!=(r=this.change_exp.exec(l[a]))&&(n=r[1].split(","),s["lhs-line-from"]=n[0]-1,1==n.length?s["lhs-line-to"]=n[0]-1:s["lhs-line-to"]=n[1]-1,n=r[3].split(","),s["rhs-line-from"]=n[0]-1,1==n.length?s["rhs-line-to"]=n[0]-1:s["rhs-line-to"]=n[1]-1,s["lhs-line-from"]<0&&(s["lhs-line-from"]=0),s["lhs-line-to"]<0&&(s["lhs-line-to"]=0),s["rhs-line-from"]<0&&(s["rhs-line-from"]=0),s["rhs-line-to"]<0&&(s["rhs-line-to"]=0),s.op=r[2],h[o++]=s,this.trace("diff","change",s)));return h},_get_viewport_side:function(t){return this.editor[t].getViewport()},_is_change_in_view:function(t,e,i){return i["".concat(t,"-line-from")]>=e.from&&i["".concat(t,"-line-from")]<=e.to||i["".concat(t,"-line-to")]>=e.from&&i["".concat(t,"-line-to")]<=e.to||e.from>=i["".concat(t,"-line-from")]&&e.to<=i["".concat(t,"-line-to")]},_set_top_offset:function(t){var e=this.editor[t].getScrollInfo().top;this.editor[t].scrollTo(null,0);var i=this.element.find(".CodeMirror-measure").first().offset().top-4;return!!i&&(this.editor[t].scrollTo(null,e),this.draw_top_offset=.5-i,!0)},_calculate_offsets:function(t,e,i){if(null==this.em_height){if(!this._set_top_offset(t))return;this.em_height=this.editor[t].defaultTextHeight(),this.em_height||(console.warn("Failed to calculate offsets, using 18 by default"),this.em_height=18),this.draw_lhs_min=.5;var s=E("#"+t+"-"+e+"-canvas");if(s.length||console.error("failed to find canvas","#"+t+"-"+e+"-canvas"),!s.width())return void console.error("canvas width is 0");this.draw_mid_width=E("#"+t+"-"+e+"-canvas").width(),this.draw_rhs_max=this.draw_mid_width-.5,this.draw_lhs_width=5,this.draw_rhs_width=5,this.trace("calc","change offsets calculated",{top_offset:this.draw_top_offset,lhs_min:this.draw_lhs_min,rhs_max:this.draw_rhs_max,lhs_width:this.draw_lhs_width,rhs_width:this.draw_rhs_width})}for(var r=this.editor[t].charCoords({line:0}),n=this.editor[e].charCoords({line:0}),h=this._get_viewport_side(t),o=(this._get_viewport_side(e),0);o<i.length;++o){var l,a,c,d,g,f,u,p,m,_=i[o];!this.settings.viewport||this._is_change_in_view(h,"lhs",_)||this._is_change_in_view(h,"rhs",_)?(f=0<=_["lhs-line-from"]?_["lhs-line-from"]:0,u=0<=_["lhs-line-to"]?_["lhs-line-to"]:0,p=0<=_["rhs-line-from"]?_["rhs-line-from"]:0,m=0<=_["rhs-line-to"]?_["rhs-line-to"]:0,m=this.editor[t].getOption("lineWrapping")||this.editor[e].getOption("lineWrapping")?(a=this.editor[t].cursorCoords({line:f,ch:0},"page"),d=this.editor[t].getLineHandle(f),l={top:a.top,bottom:a.top+d.height},c=this.editor[t].cursorCoords({line:u,ch:0},"page"),g=this.editor[t].getLineHandle(u),d={top:c.top,bottom:c.top+g.height},a=this.editor[e].cursorCoords({line:p,ch:0},"page"),g=this.editor[e].getLineHandle(p),a={top:a.top,bottom:a.top+g.height},c=this.editor[e].cursorCoords({line:m,ch:0},"page"),g=this.editor[e].getLineHandle(m),{top:c.top,bottom:c.top+g.height}):(l={top:r.top+f*this.em_height,bottom:r.bottom+f*this.em_height+2},d={top:r.top+u*this.em_height,bottom:r.bottom+u*this.em_height+2},a={top:n.top+p*this.em_height,bottom:n.bottom+p*this.em_height+2},{top:n.top+m*this.em_height,bottom:n.bottom+m*this.em_height+2}),"a"==_.op?0<p&&(l.top=l.bottom,l.bottom+=this.em_height,d=l):"d"==_.op&&0<f&&(a.top=a.bottom,a.bottom+=this.em_height,m=a),_["lhs-y-start"]=this.draw_top_offset+l.top,"c"==_.op||"d"==_.op?_["lhs-y-end"]=this.draw_top_offset+d.bottom:_["lhs-y-end"]=this.draw_top_offset+d.top,_["rhs-y-start"]=this.draw_top_offset+a.top,"c"==_.op||"a"==_.op?_["rhs-y-end"]=this.draw_top_offset+m.bottom:_["rhs-y-end"]=this.draw_top_offset+m.top,this.trace("calc","change calculated",o,_)):(delete _["lhs-y-start"],delete _["lhs-y-end"],delete _["rhs-y-start"],delete _["rhs-y-end"])}return i},_markup_changes:function(t,e,o){this.element.find(".merge-button").remove();var l=this,a=this.editor[t],c=this.editor[e],d=this._current_diff,g=this._get_viewport_side(t),f=this._get_viewport_side(e);j.start(),a.operation(function(){for(var t=0;t<o.length;++t){var e=o[t];if(this._is_change_in_view("lhs",g,e)){var i=0<=e["lhs-line-from"]?e["lhs-line-from"]:0,s=0<=e["lhs-line-to"]?e["lhs-line-to"]:0,r=0<=e["rhs-line-from"]?e["rhs-line-from"]:0,n=(0<=e["rhs-line-to"]&&e["rhs-line-to"],["mergely","lhs",e.op,"cid-"+t]);if(a.addLineClass(i,"background","start"),a.addLineClass(s,"background","end"),e["lhs-line-from"]<0&&n.push("empty"),d==t&&(i!=s&&a.addLineClass(i,"background","current"),a.addLineClass(s,"background","current")),0==i&&0==s&&0==r)a.addLineClass(i,"background",n.join(" ")),a.addLineClass(i,"background","first");else for(var h=i;h<=s;++h)a.addLineClass(h,"background",n.join(" ")),a.addLineClass(h,"background",n.join(" "));c.getOption("readOnly")||((r=l.merge_rhs_button.clone()).button&&r.button({icons:{primary:"ui-icon-triangle-1-e"},text:!1}),r.addClass("merge-button"),r.attr("id","merge-rhs-"+t),a.setGutterMarker(i,"merge",r.get(0)))}}}.bind(this)),this.trace("change","markup lhs-editor time",j.stop()),c.operation(function(){for(var t=0;t<o.length;++t){var e=o[t];if(this._is_change_in_view("rhs",f,e)){var i=0<=e["lhs-line-from"]?e["lhs-line-from"]:0,s=(0<=e["lhs-line-to"]&&e["lhs-line-to"],0<=e["rhs-line-from"]?e["rhs-line-from"]:0),r=0<=e["rhs-line-to"]?e["rhs-line-to"]:0,n=["mergely","rhs",e.op,"cid-"+t];if(c.addLineClass(s,"background","start"),c.addLineClass(r,"background","end"),e["rhs-line-from"]<0&&n.push("empty"),d==t&&(s!=r&&c.addLineClass(s,"background","current"),c.addLineClass(r,"background","current")),0==s&&0==r&&0==i)c.addLineClass(s,"background",n.join(" ")),c.addLineClass(s,"background","first");else for(var h=s;h<=r;++h)c.addLineClass(h,"background",n.join(" ")),c.addLineClass(h,"background",n.join(" "));a.getOption("readOnly")||((i=l.merge_lhs_button.clone()).button&&i.button({icons:{primary:"ui-icon-triangle-1-w"},text:!1}),i.addClass("merge-button"),i.attr("id","merge-lhs-"+t),c.setGutterMarker(s,"merge",i.get(0)))}}}.bind(this)),this.trace("change","markup rhs-editor time",j.stop());for(var i,s=[],r=0;this.settings.lcs&&r<o.length;++r){var n,h,u=o[r],p=0<=u["lhs-line-from"]?u["lhs-line-from"]:0,m=0<=u["lhs-line-to"]?u["lhs-line-to"]:0,_=0<=u["rhs-line-from"]?u["rhs-line-from"]:0,y=0<=u["rhs-line-to"]?u["rhs-line-to"]:0;if("d"==u.op){var v,w=p,b=m;!this._is_change_in_view("lhs",g,u)||(v=a.lineInfo(b))&&s.push([a,{line:w,ch:0},{line:b,ch:v.text.length},{className:"mergely ch d lhs"}])}else if("c"==u.op)for(M=p,i=_;0<=M&&M<=m||0<=i&&i<=y;++M,++i)y<i?(n=a.getLine(M),s.push([a,{line:M,ch:0},{line:M,ch:n.length},{className:"mergely ch d lhs"}])):m<M?(h=c.getLine(i),s.push([c,{line:i,ch:0},{line:i,ch:h.length},{className:"mergely ch a rhs"}])):(n=a.getLine(M),h=c.getLine(i),new V.LCS(n,h,{ignoreaccents:!!this.settings.ignoreaccents}).diff(function(t,e){l._is_change_in_view("rhs",f,u)&&s.push([c,{line:i,ch:t},{line:i,ch:e},{className:"mergely ch a rhs"}])},function(t,e){l._is_change_in_view("lhs",g,u)&&s.push([a,{line:M,ch:t},{line:M,ch:e},{className:"mergely ch d lhs"}])}))}this.trace("change","LCS marktext time",j.stop()),a.operation(function(){for(var t=0;t<s.length;++t){var e=s[t];e[0].doc.id==a.getDoc().id&&l.chfns[l.id+"-lhs"].push(e[0].markText(e[1],e[2],e[3]))}}),c.operation(function(){for(var t=0;t<s.length;++t){var e=s[t];e[0].doc.id==c.getDoc().id&&l.chfns[l.id+"-rhs"].push(e[0].markText(e[1],e[2],e[3]))}}),this.trace("change","LCS markup time",j.stop());var x={lhs:a,rhs:c};this.element.find(".merge-button").on("click",function(t){var e="rhs",i="lhs";E(this).parents("#"+l.id+"-editor-lhs").length&&(e="lhs",i="rhs");var t=x[e].coordsChar({left:t.pageX,top:t.pageY}),s=null,t=x[e].lineInfo(t.line);E.each(t.bgClass.split(" "),function(t,e){if(0==e.indexOf("cid-"))return s=parseInt(e.split("-")[1],10),!1});t=l.changes[s];return l._merge_change(t,e,i),!1});var C,A,r,M,L=E("#"+this.id+"-lhs ~ .CodeMirror .CodeMirror-code .CodeMirror-linenumber.CodeMirror-gutter-elt"),O=E("#"+this.id+"-rhs ~ .CodeMirror .CodeMirror-code .CodeMirror-linenumber.CodeMirror-gutter-elt");O.removeClass("mergely current"),L.removeClass("mergely current");var k=parseInt(L.eq(0).text(),10)-1,P=parseInt(L.eq(L.length-1).text(),10),T=parseInt(O.eq(0).text(),10)-1,S=parseInt(O.eq(O.length-1).text(),10);for(r=0;r<o.length;++r){if(u=o[r],d==r&&"a"!==u.op)for(C=u["lhs-line-from"],A=u["lhs-line-to"]+1,M=C;M<A;++M)k<=M&&M<=P&&L.eq(M-k).addClass("mergely current");if(d==r&&"d"!==u.op)for(C=u["rhs-line-from"],A=u["rhs-line-to"]+1,M=C;M<A;++M)T<=M&&M<=S&&O.eq(M-T).addClass("mergely current")}this.trace("change","markup buttons time",j.stop())},_merge_change:function(t,e,i){var s,r,n,h,o,l,a,c,d,g;t&&(g={lhs:this.editor[this.id+"-lhs"],rhs:this.editor[this.id+"-rhs"]},r=t[e+"-line-from"],n=t[e+"-line-to"],h=t[i+"-line-from"],o=t[i+"-line-to"],l=g[e].getDoc(),a=g[i].getDoc(),c=0<=r?l.getLine(r).length+1:0,d=0<=n?l.getLine(n).length+1:0,e=0<=o?a.getLine(o).length+1:0,g=0<=h?a.getLine(h).length+1:0,"c"===t.op?(s=l.getRange(f.Pos(r,0),f.Pos(n,d)),a.replaceRange(s,f.Pos(h,0),f.Pos(o,e))):"lhs"===i&&"d"===t.op||"rhs"===i&&"a"===t.op?(0<r?(s=l.getRange(f.Pos(r,c),f.Pos(n,d)),h+=1):s=l.getRange(f.Pos(0,0),f.Pos(n+1,0)),a.replaceRange(s,f.Pos(h-1,0),f.Pos(o+1,0))):("rhs"===i&&"d"===t.op||"lhs"===i&&"a"===t.op)&&(s=0<r?(c=l.getLine(r-1).length+1,l.getRange(f.Pos(r-1,c),f.Pos(n,d))):l.getRange(f.Pos(0,0),f.Pos(n+1,0)),a.replaceRange(s,f.Pos(h=h<0?0:h,g))),this._scroll_to_change(t))},_draw_info:function(t,e){var i=E(this.editor[t].getScrollerElement()).height()+17,s=E(this.editor[t].getScrollerElement()).children(":first-child").height(),r=document.getElementById(t+"-"+e+"-canvas");if(null==r)throw"Failed to find: "+t+"-"+e+"-canvas";var n=this.element.find("#"+this.id+"-lhs-margin"),h=this.element.find("#"+this.id+"-rhs-margin");return{visible_page_height:i,gutter_height:s,visible_page_ratio:i/s,margin_ratio:i/s,lhs_scroller:E(this.editor[t].getScrollerElement()),rhs_scroller:E(this.editor[e].getScrollerElement()),lhs_lines:this.editor[t].lineCount(),rhs_lines:this.editor[e].lineCount(),dcanvas:r,clhs:n,crhs:h,lhs_xyoffset:E(n).offset(),rhs_xyoffset:E(h).offset()}},_draw_diff:function(t,e,i){var s=this._draw_info(t,e),r=s.clhs.get(0),n=s.crhs.get(0),h=s.dcanvas.getContext("2d"),o=r.getContext("2d"),l=n.getContext("2d");this.trace("draw","visible_page_height",s.visible_page_height),this.trace("draw","gutter_height",s.gutter_height),this.trace("draw","visible_page_ratio",s.visible_page_ratio),this.trace("draw","lhs-scroller-top",s.lhs_scroller.scrollTop()),this.trace("draw","rhs-scroller-top",s.rhs_scroller.scrollTop()),E.each(this.element.find("canvas"),function(){E(this).get(0).height=s.visible_page_height}),s.clhs.unbind("click"),s.crhs.unbind("click"),o.beginPath(),o.fillStyle=this.settings.bgcolor,o.strokeStyle="#888",o.fillRect(0,0,6.5,s.visible_page_height),o.strokeRect(0,0,6.5,s.visible_page_height),l.beginPath(),l.fillStyle=this.settings.bgcolor,l.strokeStyle="#888",l.fillRect(0,0,6.5,s.visible_page_height),l.strokeRect(0,0,6.5,s.visible_page_height);for(var a=this._get_viewport_side(t),c=this._get_viewport_side(e),d=0;d<i.length;++d){var g=i[d],f=this.settings.fgcolor[g.op];this._current_diff===d&&(f=this.current_diff_color),this.trace("draw",g);var u,p,m=(g["lhs-y-start"]+s.lhs_scroller.scrollTop())*s.visible_page_ratio,_=(g["lhs-y-end"]+s.lhs_scroller.scrollTop())*s.visible_page_ratio+1,y=(g["rhs-y-start"]+s.rhs_scroller.scrollTop())*s.visible_page_ratio,v=(g["rhs-y-end"]+s.rhs_scroller.scrollTop())*s.visible_page_ratio+1;this.trace("draw","marker calculated",m,_,y,v),o.beginPath(),o.fillStyle=f,o.strokeStyle="#000",o.lineWidth=.5,o.fillRect(1.5,m,4.5,Math.max(_-m,5)),o.strokeRect(1.5,m,4.5,Math.max(_-m,5)),l.beginPath(),l.fillStyle=f,l.strokeStyle="#000",l.lineWidth=.5,l.fillRect(1.5,y,4.5,Math.max(v-y,5)),l.strokeRect(1.5,y,4.5,Math.max(v-y,5)),(this._is_change_in_view("lhs",a,g)||this._is_change_in_view("rhs",c,g))&&(m=g["lhs-y-start"],_=g["lhs-y-end"],y=g["rhs-y-start"],v=g["rhs-y-end"],h.beginPath(),h.strokeStyle=f,h.lineWidth=this._current_diff==d?1.5:1,u=this.draw_lhs_width,p=_-m-1,g=this.draw_lhs_min,h.moveTo(g,f=m),"Microsoft Internet Explorer"==navigator.appName?(h.lineTo(this.draw_lhs_min+this.draw_lhs_width,m),h.lineTo(this.draw_lhs_min+this.draw_lhs_width,_+1),h.lineTo(this.draw_lhs_min,_+1)):(p<=0?h.lineTo(g+u,f):(h.arcTo(g+u,f,g+u,f+3,3),h.arcTo(g+u,f+p,g+u-3,f+p,3)),h.lineTo(g,f+p)),h.stroke(),u=this.draw_rhs_width,p=v-y-1,g=this.draw_rhs_max,h.moveTo(g,f=y),"Microsoft Internet Explorer"==navigator.appName?(h.lineTo(this.draw_rhs_max-this.draw_rhs_width,y),h.lineTo(this.draw_rhs_max-this.draw_rhs_width,v+1),h.lineTo(this.draw_rhs_max,v+1)):(p<=0?h.lineTo(g-u,f):(h.arcTo(g-u,f,g-u,f+3,3),h.arcTo(g-u,f+p,g-3,f+p,3)),h.lineTo(g,f+p)),h.stroke(),f=this.draw_lhs_min+this.draw_lhs_width,p=this.draw_rhs_max-this.draw_rhs_width,y=y+(v+1-y)/2,h.moveTo(f,m=m+(_+1-m)/2),m==y?h.lineTo(p,y):h.bezierCurveTo(f+12,m-3,p-12,y-3,p,y),h.stroke())}o.fillStyle=this.settings.vpcolor,l.fillStyle=this.settings.vpcolor;var w=s.clhs.height()*s.visible_page_ratio,t=s.lhs_scroller.scrollTop()/s.gutter_height*s.clhs.height(),b=s.crhs.height()*s.visible_page_ratio,e=s.rhs_scroller.scrollTop()/s.gutter_height*s.crhs.height();this.trace("draw","cls.height",s.clhs.height()),this.trace("draw","lhs_scroller.scrollTop()",s.lhs_scroller.scrollTop()),this.trace("draw","gutter_height",s.gutter_height),this.trace("draw","visible_page_ratio",s.visible_page_ratio),this.trace("draw","lhs from",t,"lhs to",w),this.trace("draw","rhs from",e,"rhs to",b),o.fillRect(1.5,t,4.5,w),l.fillRect(1.5,e,4.5,b),s.clhs.click(function(t){t=t.pageY-s.lhs_xyoffset.top-w/2,t=Math.max(0,t/r.height*s.lhs_scroller.get(0).scrollHeight);s.lhs_scroller.scrollTop(t)}),s.crhs.click(function(t){t=t.pageY-s.rhs_xyoffset.top-b/2,t=Math.max(0,t/n.height*s.rhs_scroller.get(0).scrollHeight);s.rhs_scroller.scrollTop(t)})},trace:function(t){0<=this.settings._debug.indexOf(t)&&(arguments[0]=t+":",console.log([].slice.apply(arguments)))}}),E.pluginMaker=function(h){E.fn[h.prototype.name]=function(i){var s,r=E.makeArray(arguments),n=r.slice(1);if(this.each(function(){var t=this,e=E.data(this,h.prototype.name);if(e){if("string"==typeof i)s=e[i].apply(e,n);else if(e.update)return e.update.apply(e,r)}else new h(this,i),E.fn["".concat(h.prototype.name,"Unregister")]=function(){E.data(t,h.prototype.name,null)}}),null!=s)return s}},E.pluginMaker(V.mergely)}(i(2),i(3))},function(t,e){function i(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var s,r,n,n=(r=h,n=[{key:"start",value:function(){h.t0=Date.now()}},{key:"stop",value:function(){var t=Date.now(),e=t-h.t0;return h.t0=t,e}}],(s=null)&&i(r.prototype,s),i(r,n),h);function h(){!function(t){if(!(t instanceof h))throw new TypeError("Cannot call a class as a function")}(this)}n.t0=0,t.exports=n},function(t,e){t.exports=i},function(t,e){t.exports=s}],h={},r.m=n,r.c=h,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(i,s,function(t){return e[t]}.bind(null,s));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0);function r(t){if(h[t])return h[t].exports;var e=h[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,r),e.l=!0,e.exports}var n,h});