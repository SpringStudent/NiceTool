<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>开发者在线工具箱</title>
    <!-- 保持原有的依赖引用 -->
    <script type="text/javascript" src="./js/vue.js"></script>
    <script type="text/javascript" src="./js/json2.js"></script>
    <script type="text/javascript" src="./js/jsonlint.js"></script>
    <script type="text/javascript" src="./js/axios.min.js"></script>
    <script type="text/javascript" src="./js/codemirror.min.js"></script>
    <script type="text/javascript" src="./js/vue-codemirror.js"></script>
    <script type="text/javascript" src="./js/javascript/javascript.js"></script>
    <script type="text/javascript" src="./js/fold/brace-fold.js"></script>
    <script type="text/javascript" src="./js/fold/comment-fold.js"></script>
    <script type="text/javascript" src="./js/fold/foldcode.js"></script>
    <script type="text/javascript" src="./js/fold/foldgutter.js"></script>
    <script type="text/javascript" src="./js/fold/indent-fold.js"></script>
    <script type="text/javascript" src="./js/fold/markdown-fold.js"></script>
    <script type="text/javascript" src="./js/fold/xml-fold.js"></script>
    <script type="text/javascript" src="./js/jquery.min.js"></script>
    <script type="text/javascript" src="./js/crypto-js.min.js"></script>
    <script src="./js/mergely.min.js"></script>
    <!-- 样式文件 -->
    <link href="./js/fold/foldgutter.css" rel="stylesheet">
    <link href="./css/theme/eclipse.css" rel="stylesheet">
    <link href="./css/codemirror.min.css" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="./css/mergely.css"/>
    <!-- 引入图标库 -->
    <link href="./css/fontawesome/all.min.css" rel="stylesheet">

    <style>
        :root {
            --sidebar-bg: #001529;
            --sidebar-text: #a6adb4;
            --active-bg: #1890ff;
            --main-bg: #f0f2f5;
            --card-bg: #ffffff;
            --text-color: #333;
            --border-color: #d9d9d9;
        }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--main-bg);
            height: 100vh;
            overflow: hidden;
            color: var(--text-color);
        }

        #app {
            display: flex;
            height: 100vh;
        }

        /* 侧边栏样式 */
        .sidebar {
            width: 240px;
            background-color: var(--sidebar-bg);
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 8px rgba(0,0,0,0.15);
            z-index: 10;
        }

        .brand {
            height: 64px;
            line-height: 64px;
            text-align: center;
            color: white;
            font-size: 20px;
            font-weight: bold;
            background-color: #002140;
            letter-spacing: 1px;
        }

        .brand i { margin-right: 10px; }

        .nav-menu {
            padding: 0;
            margin: 0;
            list-style: none;
            margin-top: 10px;
        }

        .nav-item {
            color: var(--sidebar-text);
            cursor: pointer;
            padding: 15px 24px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            font-size: 14px;
        }

        .nav-item i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .nav-item:hover {
            color: white;
            background-color: rgba(255,255,255,0.08);
        }

        .nav-item.active {
            background-color: var(--active-bg);
            color: white;
        }

        /* 主体内容区 */
        .main-content {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        /* 通用卡片样式 */
        .card {
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 24px;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* 防止内容溢出 */
        }

        /* 标题 */
        .page-header {
            margin-bottom: 20px;
            font-size: 20px;
            font-weight: 600;
            color: #1f1f1f;
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 15px;
        }

        /* 输入控件美化 */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .text-input, .number-input, .select-input {
            width: 100%;
            padding: 8px 12px;
            font-size: 14px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            transition: border 0.3s;
            box-sizing: border-box; /* 关键 */
        }

        .text-input:focus, .number-input:focus, .select-input:focus {
            border-color: var(--active-bg);
            outline: none;
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
        }

        /* 按钮美化 */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .btn-primary {
            background-color: var(--active-bg);
            color: white;
            box-shadow: 0 2px 0 rgba(0,0,0,0.045);
        }

        .btn-primary:hover {
            background-color: #40a9ff;
        }

        .btn-success { background-color: #52c41a; color: white; }
        .btn-success:hover { background-color: #73d13d; }

        /* 特殊区域布局 */
        /* JSON 区域 */
        .json-container {
            display: flex;
            gap: 20px;
            height: calc(100% - 60px);
        }
        .json-box {
            flex: 1;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            overflow: hidden;
        }
        .json-box-header {
            background: #fafafa;
            padding: 8px 12px;
            border-bottom: 1px solid var(--border-color);
            font-size: 12px;
            color: #888;
        }
        .json-textarea {
            flex: 1;
            width: 100%;
            border: none;
            resize: none;
            padding: 10px;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            outline: none;
        }

        /* Text Diff */
        #textDiffDiv {
            height: 100%;
            width: 100%;
        }

        /* Result Display */
        .result-box {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 4px;
            word-break: break-all;
        }
        .result-label {
            font-size: 16px;
            color: #666;
            margin-bottom: 10px;
            display: block;
        }
        .result-content {
            font-family: monospace;
            color: #000;
            font-size: 16px;
            font-weight: 500;
        }
        .error-msg { color: #ff4d4f; }

        /* Time Convert Table */
        .time-table {
            width: 100%;
            border-collapse: collapse;
        }
        .time-table td {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
        }
        .time-table input {
            width: 200px;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .time-badge {
            background: #000;
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
        }

        /* Image Gen Form Layout */
        .image-form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: flex-end;
            margin-bottom: 20px;
        }
        .form-item {
            display: flex;
            flex-direction: column;
            position: relative;
        }
        .input-error {
            color: #ff4d4f;
            font-size: 12px;
            position: absolute;
            bottom: -18px;
            left: 0;
        }
        /* JSON 专用布局 */
        .json-toolbar {
            height: 40px;
            border-bottom: 1px solid #ddd;
            background-color: #f7f7f7;
            display: flex;
            align-items: center;
            padding: 0 15px;
            flex-shrink: 0;
        }

        .tool-btn {
            display: inline-block;
            padding: 5px 12px;
            margin-right: 10px;
            font-size: 13px;
            color: #333;
            cursor: pointer;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .tool-btn:hover {
            background-color: #e6f7ff;
            color: #1890ff;
            border-color: #1890ff;
        }

        .json-editor-container {
            flex: 1;
            display: flex;
            overflow: hidden; /* 防止撑开 */
            position: relative;
        }

        .editor-half {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0; /* 关键：防止flex子项溢出 */
            position: relative;
        }

        .editor-divider {
            width: 1px;
            background-color: #ddd;
            z-index: 5;
        }

        .pane-label {
            padding: 5px 10px;
            background-color: #fafafa;
            border-bottom: 1px solid #eee;
            font-size: 12px;
            color: #999;
        }

        /* 覆盖 CodeMirror 默认样式以适应全屏 */
        .vue-codemirror {
            flex: 1;
            height: 100%;
            overflow: hidden;
        }

        /* 错误提示框 */
        .json-error-box {
            padding: 20px;
            color: #a94442;
            background-color: #f2dede;
            border: 1px solid #ebccd1;
            margin: 10px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }

        /* Base64 左右布局专用样式 */
        .base64-layout {
            display: flex;
            flex: 1;
            gap: 20px;
            height: calc(100% - 60px); /* 减去标题高度 */
            align-items: center; /* 垂直居中 */
        }

        .base64-col {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .base64-textarea {
            flex: 1; /* 撑满高度 */
            resize: none;
            font-family: 'Consolas', monospace;
            line-height: 1.5;
            background-color: #fafafa;
        }

        .base64-textarea:focus {
            background-color: #fff;
        }

        .base64-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            justify-content: center;
        }

        .btn-icon {
            width: 100px; /* 固定按钮宽度 */
            display: flex;
            justify-content: space-between; /* 图标文字两端对齐 */
            padding: 10px 15px;
        }

        .char-count {
            text-align: right;
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }

        /* 时间戳徽章容器 */
        .time-badge-wrapper {
            display: inline-flex;
            align-items: center;
            background: #303133;
            border-radius: 4px;
            padding: 5px 12px;
            margin: 0 10px;
            color: #fff;
            font-family: 'Consolas', monospace; /* 使用等宽字体防止数字跳动 */
        }

        /* 数字样式 */
        .time-badge {
            font-size: 24px;
            font-weight: bold;
            margin-right: 10px;
            min-width: 140px; /* 固定宽度，防止因为时间变化导致图标左右抖动 */
            text-align: right;
        }

        /* 复制图标样式 */
        .copy-icon {
            cursor: pointer;
            font-size: 16px;
            color: #909399;
            transition: all 0.2s;
            padding: 5px;
        }

        .copy-icon:hover {
            color: #409eff; /* 悬停变蓝 */
            transform: scale(1.1); /* 微微放大 */
        }

        .copy-icon:active {
            transform: scale(0.95); /* 点击回缩 */
        }
        /* CodeMirror Fixes */
        .vue-codemirror { height: 100%; }
        .CodeMirror { height: 100% !important; font-family: 'Consolas', monospace; font-size: 14px; }
    </style>
</head>
<body>
<div id="app">
    <!-- 侧边栏 -->
    <aside class="sidebar">
        <div class="brand"><i class="fa-solid fa-toolbox"></i> 开发者工具</div>
        <ul class="nav-menu">
            <li class="nav-item" :class="{active: divId=='jsonPretty'}" @click="changeDiv('jsonPretty')">
                <i class="fa-solid fa-code"></i> JSON 验证
            </li>
            <li class="nav-item" :class="{active: divId=='textDiff'}" @click="changeDiv('textDiff')">
                <i class="fa-solid fa-right-left"></i> 文本比对
            </li>
            <li class="nav-item" :class="{active: divId=='genUuid'}" @click="changeDiv('genUuid')">
                <i class="fa-solid fa-fingerprint"></i> UUID生成
            </li>
            <li class="nav-item" :class="{active: divId=='md5'}" @click="changeDiv('md5')">
                <i class="fa-solid fa-lock"></i> MD5加密
            </li>
            <li class="nav-item" :class="{active: divId=='timeConvert'}" @click="changeDiv('timeConvert')">
                <i class="fa-regular fa-clock"></i> 时间转换
            </li>
            <li class="nav-item" :class="{active: divId=='createImage'}" @click="changeDiv('createImage')">
                <i class="fa-regular fa-image"></i> 图片生成
            </li>
            <li class="nav-item" :class="{active: divId=='ipRegion'}" @click="changeDiv('ipRegion')">
                <i class="fa-solid fa-location-dot"></i> IP归属地
            </li>
            <li class="nav-item" :class="{active: divId=='urlConvert'}" @click="divId='urlConvert'">
                <i class="fa-solid fa-link"></i> URL编解码
            </li>
            <li class="nav-item" :class="{active: divId=='base64'}" @click="divId='base64'">
                <i class="fa-solid fa-exchange-alt"></i> Base64转换
            </li>
        </ul>
    </aside>

    <!-- 主体内容 -->
    <main class="main-content">

        <!-- JSON 验证 -->
        <!-- JSON 验证/格式化 区域 -->
        <div id="jsonPretty" v-show="divId=='jsonPretty'" class="card" style="padding: 0; display: flex; flex-direction: column; height: 100%;">
            <!-- 顶部工具栏 -->
            <div class="json-toolbar">
                <div class="toolbar-left">
                    <span class="tool-btn" @click="jsonPretty"><i class="fa-solid fa-indent"></i> 格式化</span>
                    <span class="tool-btn" @click="jsonCompress"><i class="fa-solid fa-compress"></i> 压缩</span>
                    <span class="tool-btn" @click="jsonClear"><i class="fa-solid fa-trash-can"></i> 清空</span>
                </div>
                <div class="toolbar-right">
                    <!-- 可以在这里加 保存/复制 等按钮 -->
                </div>
            </div>

            <!-- 左右分栏编辑器 -->
            <div class="json-editor-container">
                <!-- 左侧：输入区 -->
                <div class="editor-half">
                    <div class="pane-label">输入 (Source)</div>
                    <!-- 使用 codemirror 替换原有的 textarea -->
                    <local-codemirror
                            ref="jsonInputRef"
                            v-model="jsonInput"
                            :options="inputOption"
                            @input="handleJsonChange">
                    </local-codemirror>
                </div>

                <!-- 中间：分割线/错误提示 -->
                <div class="editor-divider"></div>

                <!-- 右侧：展示区 -->
                <div class="editor-half">
                    <div class="pane-label">
                        解析结果 (Tree)
                        <span v-if="jsonError" style="color: #ff4d4f; font-size: 12px; margin-left: 10px;">
                    <i class="fa-solid fa-circle-exclamation"></i> 格式错误
                </span>
                        <span v-else style="color: #52c41a; font-size: 12px; margin-left: 10px;">
                    <i class="fa-solid fa-check-circle"></i> 有效
                </span>
                    </div>
                    <!-- 结果显示 -->
                    <div v-if="jsonError" class="json-error-box">{{jsonError}}</div>
                    <local-codemirror
                            v-show="!jsonError"
                            ref="jsonOutputRef"
                            v-model="jsonOutput"
                            :options="outputOption">
                    </local-codemirror>
                </div>
            </div>
        </div>

        <!-- 文本比对 -->
        <div v-show="divId=='textDiff'" class="card">
            <div class="page-header">文本差异比对</div>
            <div style="flex: 1; position: relative;">
                <div id="textDiffDiv"></div>
            </div>
        </div>

        <!-- UUID 生成 -->
        <div v-show="divId=='genUuid'" class="card">
            <div class="page-header">UUID 批量生成</div>
            <div class="form-group">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="number" maxlength="3" class="number-input" style="width: 200px;"
                           v-model="uuidCount" placeholder="生成数量 (Max 100)" min="1" max="100"/>
                    <button @click="doGenUuid()" class="btn btn-primary"><i class="fa-solid fa-bolt"></i> 生成</button>
                </div>
            </div>

            <div class="result-box" v-show="uuids && uuids.length > 0">
                <label class="result-label">已生成 {{uuids.length}} 个 UUID:</label>
                <div class="result-content" style="max-height: 400px; overflow-y: auto;">
                    <div v-for="uuid in uuids" :key="uuid" style="padding: 4px 0; border-bottom: 1px dashed #eee;">
                        {{uuid}}
                    </div>
                </div>
            </div>
        </div>

        <!-- MD5 加密 -->
        <div v-show="divId=='md5'" class="card">
            <div class="page-header">MD5 加密</div>
            <div class="form-group">
                <textarea class="text-input" style="height: 100px; resize: vertical;"
                          v-model="md5Text" placeholder="输入需要加密的字符串"></textarea>
            </div>
            <button @click="doMd5()" class="btn btn-primary"><i class="fa-solid fa-lock"></i> 开始加密</button>

            <div class="result-box" v-if="md5Result!=''">
                <label class="result-label">加密结果 (32位小写):</label>
                <span class="result-content" style="color: #2ecc71; font-size: 18px;">{{md5Result}}</span>
            </div>
            <div class="result-box" v-if="md5Error!=''" style="background: #fff1f0; border-color: #ffa39e;">
                <span class="error-msg">{{md5Error}}</span>
            </div>
        </div>

        <!-- IP 归属地 (代码中有逻辑，页面保留结构) -->
        <div v-show="divId=='ipRegion'" class="card">
            <div class="page-header">IP 归属地查询</div>
            <div class="form-group" style="display:flex; gap:10px;">
                <input type="text" class="text-input" style="width: 300px;" v-model="ipText" placeholder="输入 IP 地址"/>
                <button @click="doIpRegion()" class="btn btn-primary">查询</button>
            </div>
            <div class="result-box" v-if="ipRegionResult!=''">
                <label class="result-label">归属地:</label>
                <span class="result-content">{{ipRegionResult}}</span>
            </div>
            <div class="result-box" v-if="ipRegionError!=''">
                <span class="error-msg">{{ipRegionError}}</span>
            </div>
        </div>

        <!-- 图片生成 -->
        <div v-show="divId=='createImage'" class="card">
            <div class="page-header">占位图片生成器</div>

            <div class="image-form-row">
                <div class="form-item">
                    <label class="form-label">背景色</label>
                    <input type="color" v-model="imageColor" style="height: 38px; width: 60px; padding: 0; border: none; cursor: pointer;"/>
                </div>

                <div class="form-item">
                    <label class="form-label">宽度 (px)</label>
                    <input type="number" class="number-input" v-model="imageWidth" placeholder="100-2000" style="width: 120px;">
                    <span class="input-error" v-show="imageWidthError">{{imageWidthError}}</span>
                </div>

                <div class="form-item">
                    <label class="form-label">高度 (px)</label>
                    <input type="number" class="number-input" v-model="imageHeight" placeholder="100-2000" style="width: 120px;">
                    <span class="input-error" v-show="imageHeightError">{{imageHeightError}}</span>
                </div>

                <div class="form-item">
                    <label class="form-label">文件大小 (MB)</label>
                    <input type="number" class="number-input" v-model="imageMB" placeholder="Max 200" style="width: 120px;">
                    <span class="input-error" v-show="imageMBError">{{imageMBError}}</span>
                </div>

                <div class="form-item">
                    <label class="form-label">格式</label>
                    <select class="select-input" v-model="imageType" style="width: 100px;">
                        <option value="jpg">JPG</option>
                        <option value="jpeg">JPEG</option>
                        <option value="png">PNG</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <button @click="doViewImage()" class="btn btn-primary"><i class="fa-regular fa-eye"></i> 预览</button>
                <button @click="doCreateImage(1)" class="btn btn-success"><i class="fa-solid fa-download"></i> 下载</button>
                <span style="margin: 0 10px; color: #ccc;">|</span>
                <span style="font-size: 13px; color: #666; margin-right: 10px;">批量下载:</span>
                <button @click="doCreateImage(5)" class="btn" style="background: #e6f7ff; color: #1890ff; border: 1px solid #91d5ff;">5个</button>
                <button @click="doCreateImage(10)" class="btn" style="background: #e6f7ff; color: #1890ff; border: 1px solid #91d5ff;">10个</button>
            </div>

            <div class="result-box" v-if="createImageResult!=''" style="text-align: center;">
                <img :src="createImageResult" style="max-width: 100%; border: 1px solid #ddd; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"/>
            </div>
            <div class="result-box" v-if="createImageError!=''" style="background: #fff1f0;">
                <span class="error-msg">{{createImageError}}</span>
            </div>
        </div>

        <!-- 时间转换 -->
        <div v-show="divId=='timeConvert'" class="card card-padded">
            <div class="page-header">Unix 时间戳转换</div>

            <div style="margin-bottom: 30px; padding: 20px; background: #fdf6ec; border-radius: 6px; text-align: center;">
                <div style="font-size: 14px; color: #e6a23c; margin-bottom: 15px;">当前系统时间 (点击图标复制)</div>
                <div class="time-badge-wrapper">
                <span class="time-badge">
                    {{nowSeconds}} <small style="opacity:0.6; font-size:12px">s</small>
                </span>
                    <i class="fa-regular fa-copy copy-icon" @click="copyToClip(nowSeconds)" title="复制秒"></i>
                </div>
                <div class="time-badge-wrapper">
                <span class="time-badge">
                    {{nowMillSeconds}} <small style="opacity:0.6; font-size:12px">ms</small>
                </span>
                    <i class="fa-regular fa-copy copy-icon" @click="copyToClip(nowMillSeconds)" title="复制毫秒"></i>
                </div>
            </div>

            <table class="time-table">
                <tbody>
                <tr>
                    <td width="100">时间日期</td>
                    <td><input type="text" class="text-input" v-model="inputDate"></td>
                    <td width="80"><button class="btn btn-primary" style="margin:0" @click="date2Mills()"> <i class="fa-solid fa-arrow-right"></i> </button></td>
                    <td><input type="text" class="text-input" v-model="inputDateMills"></td>
                    <td width="80">毫秒</td>
                </tr>
                <tr>
                    <td>时间日期</td>
                    <td><input type="text" class="text-input" v-model="inputDate"></td>
                    <td><button class="btn btn-primary" style="margin:0" @click="date2Seconds()"> <i class="fa-solid fa-arrow-right"></i> </button></td>
                    <td><input type="text" class="text-input" v-model="inputDateSeconds"></td>
                    <td>秒</td>
                </tr>
                <tr>
                    <td>时间戳(秒)</td>
                    <td><input type="text" class="text-input" v-model="inputSeconds"></td>
                    <td><button class="btn btn-primary" style="margin:0" @click="seconds2Date()"> <i class="fa-solid fa-arrow-right"></i> </button></td>
                    <td colspan="2"><input type="text" class="text-input" v-model="inputSecondsDate"></td>
                </tr>
                <tr>
                    <td>时间戳(毫秒)</td>
                    <td><input type="text" class="text-input" v-model="inputMills"></td>
                    <td><button class="btn btn-primary" style="margin:0" @click="mills2Date()"> <i class="fa-solid fa-arrow-right"></i> </button></td>
                    <td colspan="2"><input type="text" class="text-input" v-model="inputMillsDate"></td>
                </tr>
                </tbody>
            </table>
        </div>
        <!-- URL 编码/解码 -->
        <div v-show="divId=='urlConvert'" class="card card-padded">
            <div class="page-header">URL编码/解码</div>

            <div class="form-group">
                <label class="form-label">输入内容:</label>
                <textarea class="text-input" style="height:100px" v-model="urlInput" placeholder="输入 URL 或 字符串..."></textarea>
            </div>

            <div class="form-group">
                <button class="btn" @click="doUrlEncode">编码 (Encode)</button>
                <button class="btn btn-success" @click="doUrlDecode">解码 (Decode)</button>
                <button class="btn" style="background:#ff4d4f" @click="urlInput=''; urlOutput=''">清空</button>
            </div>

            <div class="form-group">
                <label class="form-label">转换结果:</label>
                <textarea class="text-input" style="height:100px; background:#f9f9f9" readonly v-model="urlOutput"></textarea>
            </div>
        </div>

        <!-- Base64 加解密 (左右分栏布局) -->
        <div v-show="divId=='base64'" class="card" style="padding: 20px;">
            <div class="page-header">Base64 编码 / 解码</div>

            <div class="base64-layout">
                <!-- 左侧：明文 -->
                <div class="base64-col">
                    <div class="form-label">明文 (Text / Source)</div>
                    <textarea class="text-input base64-textarea"
                              v-model="base64Left"
                              placeholder="请输入要编码的文本..."></textarea>
                    <div class="char-count">长度: {{base64Left.length}}</div>
                </div>

                <!-- 中间：操作按钮 -->
                <div class="base64-controls">
                    <button class="btn btn-primary btn-icon" @click="doBase64Encode" title="编码: 左 -> 右">
                        编码 <i class="fa-solid fa-arrow-right"></i>
                    </button>

                    <button class="btn btn-success btn-icon" @click="doBase64Decode" title="解码: 右 -> 左">
                        <i class="fa-solid fa-arrow-left"></i> 解码
                    </button>

                    <button class="btn btn-danger btn-icon" @click="clearBase64" title="清空所有">
                        <i class="fa-solid fa-trash"></i> 清空
                    </button>
                </div>

                <!-- 右侧：密文 -->
                <div class="base64-col">
                    <div class="form-label">Base64 (Result)</div>
                    <textarea class="text-input base64-textarea"
                              v-model="base64Right"
                              placeholder="请输入要解码的 Base64 字符串..."></textarea>
                    <div class="char-count">长度: {{base64Right.length}}</div>
                </div>
            </div>
            <!-- 错误提示 -->
            <div v-if="base64Error" style="margin-top: 15px; color: #ff4d4f; background: #fff1f0; padding: 10px; border-radius: 4px;">
                <i class="fa-solid fa-circle-exclamation"></i> {{base64Error}}
            </div>
        </div>
    </main>
</div>

<!-- JS 逻辑部分，基本未变动，只微调了 UUID 清空逻辑以适配 UI -->
<script type="module">
    const server_url = "http://localhost:8555";
    Vue.use(VueCodemirror)
    var vm = new Vue({
        el: "#app",
        data: {
            divId: '',
            md5Text: '',
            ipText: '',
            imageWidth: '1000',
            imageWidthError: '',
            imageHeight: '680',
            imageHeightError: '',
            imageMB: '5',
            imageMBError: '',
            imageType: 'jpg',
            uuidCount: '',
            uuids: [],
            md5Result: '',
            md5Error: '',
            createImageUri: '',
            ipRegionResult: '',
            ipRegionError: '',
            nowSeconds: '',
            nowMillSeconds: '',
            inputDate: '',
            inputDateMills: '',
            inputDateSeconds: '',
            inputSeconds: '',
            inputMills: '',
            inputSecondsDate: '',
            inputMillsDate: '',
            imageColor: '#FFFFFF',
            createImageResult: '',
            createImageError: '',
            jsonInput: '',
            jsonOutput: '',
            jsonError: '',
            urlInput: '',
            urlOutput: '',
            base64Left: '',
            base64Right: '',
            base64Error: '',
            inputOption: {
                tabSize: 2,
                mode: 'application/json', // 确保引入了 javascript 模式，它包含 json
                theme: 'eclipse',
                lineNumbers: true,
                lineWrapping: true,
                styleActiveLine: true,
                matchBrackets: true,
                autoCloseBrackets: true,
                // 输入框一般不需要折叠，但你想加也可以加
            },
            outputOption: {
                tabSize: 2,
                mode: 'application/json',
                theme: 'eclipse',
                lineNumbers: true,
                lineWrapping: true,
                readOnly: true,
                foldGutter: {
                    rangeFinder: new CodeMirror.fold.combine(CodeMirror.fold.indent, CodeMirror.fold.comment)
                },
                gutters: ['CodeMirror-linenumbers', 'CodeMirror-foldgutter'],
            }
        },
        components: {
            LocalCodemirror: VueCodemirror.codemirror
        },
        mounted() {
            var current = new Date();
            this.inputDate = this.formatDate(current);
            this.inputMills = current.getTime();
            this.inputSeconds = Math.round(current.getTime() / 1000);
            this.changeDiv('jsonPretty');
            this.startTimer();
        },
        methods: {
            startTimer() {
                setInterval(() => {
                    this.nowMillSeconds = new Date().getTime();
                    this.nowSeconds = Math.round(new Date().getTime() / 1000);
                }, 1000);
            },
            isIp(ip) {
                var ip_arr = ip.split('.');
                if (ip_arr.length != 4) {
                    return false;
                }
                for (var i = 0; i < ip_arr.length; i++) {
                    if (ip_arr[i] < 0 || ip_arr[i] > 255) {
                        return false;
                    }
                }
                return true;
            },
            // 监听输入变化，实时格式化
            handleJsonChange() {
                this.jsonPretty();
            },
            // 格式化逻辑
            jsonPretty() {
                this.jsonError = ''; // 重置错误
                if (!this.jsonInput) {
                    this.jsonOutput = '';
                    return;
                }
                try {
                    // 使用 jsonlint 解析，它比原生 JSON.parse 报错更详细
                    var result = jsonlint.parse(this.jsonInput);
                    if (result) {
                        // 格式化输出，缩进2空格
                        this.jsonOutput = JSON.stringify(result, null, 2);
                    }
                } catch (e) {
                    // 捕获错误显示在界面上
                    this.jsonError = e.message;
                    // 可以在这里不清空 output，保留上一次正确的结果，或者清空看你喜好
                    // this.jsonOutput = "";
                }
            },

            // 压缩逻辑
            jsonCompress() {
                this.jsonError = '';
                if (!this.jsonInput) return;
                try {
                    var result = jsonlint.parse(this.jsonInput);
                    this.jsonOutput = JSON.stringify(result);
                } catch (e) {
                    this.jsonError = e.message;
                }
            },

            // 清空
            jsonClear() {
                this.jsonInput = '';
                this.jsonOutput = '';
                this.jsonError = '';
            },
            changeDiv(divId) {
                this.divId = divId;
                // 使用 nextTick 或 setTimeout 确保 DOM 更新
                setTimeout(() => {
                    if (this.divId == 'textDiff') {
                        // 确保 Mergely 容器可见后再初始化
                        $('#textDiffDiv').mergely({
                            lhs: function (setValue) {
                                setValue('the quick red fox\njumped over the hairy dog');
                            },
                            rhs: function (setValue) {
                                setValue('the quick brown fox\njumped over the lazy dog');
                            },
                            editor_width: '100%', // 设为 100% 适配新布局
                            editor_height: '100%',
                            resize_on_window_resize: true // 开启自适应
                        });
                    }
                }, 100);

            },
            doGenUuid() {
                // 先清空数组
                this.uuids = [];
                if (this.uuidCount == '' || this.uuidCount > 100) {
                    this.uuidCount = 100;
                }
                for (var i = 0; i < this.uuidCount; i++) {
                    this.uuids.push(this.genUuid());
                }
            },
            genUuid() {
                return 'xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                    var r = Math.random()*16|0, v = c == 'x' ? r : (r&0x3|0x8);
                    return v.toString(16);
                });
            },
            doMd5() {
                this.md5Result = '';
                this.md5Error = '';
                if (this.md5Text == '') {
                    this.md5Error = '加密字符串不能为空';
                    return;
                }
                // 确保 CryptoJS 已加载
                if(window.CryptoJS) {
                    this.md5Result = window.CryptoJS.MD5(this.md5Text).toString();
                } else {
                    this.md5Error = "CryptoJS 库加载失败";
                }
            },
            doIpRegion() {
                this.ipRegionResult = '';
                this.ipRegionError = '';
                if (this.ipText == '') {
                    this.ipRegionError = '请输入ip地址';
                    return;
                } else {
                    if (!this.isIp(this.ipText)) {
                        this.ipRegionError = 'ip地址不合法';
                        return;
                    }
                }
                axios.get(server_url + '/tool/ipRegion?ip=' + this.ipText)
                    .then((response) => {
                        if (response.status == 200) {
                            if (response.data.code == 200) {
                                this.ipRegionResult = response.data.result;
                            } else {
                                this.ipRegionError = response.data.msg;
                            }
                        }
                    })
                    .catch((error) => {
                        this.ipRegionError = error.message || "请求失败";
                    });
            },
            validateImageParam() {
                this.imageWidthError = '';
                this.imageHeightError = '';
                this.imageMBError = '';
                var result = true;
                if (!this.imageWidth) {
                    this.imageWidthError = '必填';
                    result = false;
                } else if (this.imageWidth < 0 || this.imageWidth > 2000) {
                    this.imageWidthError = '范围 0-2000';
                    result = false;
                }

                if (!this.imageHeight) {
                    this.imageHeightError = '必填';
                    result = false;
                } else if (this.imageHeight < 0 || this.imageHeight > 2000) {
                    this.imageHeightError = '范围 0-2000';
                    result = false;
                }

                if (!this.imageMB) {
                    this.imageMBError = '必填';
                    result = false;
                } else if (this.imageMB < 0 || this.imageMB > 200) {
                    this.imageMBError = '范围 0-200';
                    result = false;
                }
                return result;
            },
            doViewImage() {
                if (this.validateImageParam()) {
                    this.createImageResult = '';
                    this.createImageError = '';
                    axios.get(server_url + "/tool/createImage?width=" + this.imageWidth + "&height=" + this.imageHeight + "&MB=" + this.imageMB + "&imageType=" + this.imageType + "&imageColor=" + this.imageColor.substr(1) + "&timestamp=" + new Date().getTime(), {responseType: 'blob'})
                        .then((res) => {
                            if (res.status == 200) {
                                var responseType = res.headers['content-type'];
                                if (responseType && responseType.startsWith("application/json")) {
                                    const reader = new FileReader();
                                    reader.readAsText(res.data, 'utf-8');
                                    reader.onload = () => {
                                        try {
                                            this.createImageError = JSON.parse(reader.result).msg;
                                        } catch(e) { this.createImageError = "解析错误"; }
                                    }
                                } else {
                                    const blob = new Blob([res.data], {type: responseType});
                                    const URL = window.URL || window.webkitURL;
                                    this.createImageResult = URL.createObjectURL(blob);
                                }
                            }
                        })
                        .catch((error) => {
                            this.createImageError = error.message;
                        });
                }
            },
            doCreateImage(imageNum) {
                if (this.validateImageParam()) {
                    this.createImageResult = '';
                    this.createImageError = '';
                    let baseUrl = "/tool/createImage?";
                    if (imageNum > 1) {
                        baseUrl = "/tool/createBatchImage?imageNum=" + imageNum + "&";
                    }
                    axios.get(server_url + baseUrl + "width=" + this.imageWidth + "&height=" + this.imageHeight + "&MB=" + this.imageMB + "&imageType=" + this.imageType + "&imageColor=" + this.imageColor.substr(1) + "&timestamp=" + new Date().getTime(), {responseType: 'blob'})
                        .then((res) => {
                            if (res.status == 200) {
                                var responseType = res.headers['content-type'];
                                if (responseType && responseType.startsWith("application/json")) {
                                    const reader = new FileReader();
                                    reader.readAsText(res.data, 'utf-8');
                                    reader.onload = () => {
                                        this.createImageError = JSON.parse(reader.result).msg;
                                    }
                                } else {
                                    var filename = "image." + this.imageType;
                                    var filenameRegex = /filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;
                                    var matches = filenameRegex.exec(res.headers['content-disposition']);
                                    if (matches != null && matches[1]) {
                                        filename = matches[1].replace(/['"]/g, '');
                                    }
                                    const blob = new Blob([res.data], {type: responseType});
                                    if (window.navigator && window.navigator.msSaveOrOpenBlob) {
                                        window.navigator.msSaveOrOpenBlob(blob, filename)
                                    } else {
                                        const url = URL.createObjectURL(blob);
                                        const link = document.createElement('a');
                                        link.href = url;
                                        link.download = filename;
                                        document.body.appendChild(link);
                                        link.click();
                                        document.body.removeChild(link);
                                        URL.revokeObjectURL(url);
                                    }
                                }
                            }
                        })
                        .catch((error) => {
                            this.createImageError = error.message;
                        });
                }
            },
            formatDate(date) {
                const year = date.getFullYear();
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const day = date.getDate().toString().padStart(2, '0');
                const hour = date.getHours().toString().padStart(2, '0');
                const minute = date.getMinutes().toString().padStart(2, '0');
                const second = date.getSeconds().toString().padStart(2, '0');
                return `${year}-${month}-${day} ${hour}:${minute}:${second}`;
            },
            parseDate(dateStr) {
                return Date.parse(new Date(dateStr).toString());
            },
            date2Mills() {
                this.inputDateMills = this.parseDate(this.inputDate);
            },
            date2Seconds() {
                this.inputDateSeconds = Math.round(this.parseDate(this.inputDate) / 1000);
            },
            seconds2Date() {
                this.inputSecondsDate = this.formatDate(new Date(this.inputSeconds * 1000));
            },
            mills2Date() {
                this.inputMillsDate = this.formatDate(new Date(this.inputMills * 1));
            },
            doUrlEncode() {
                try {
                    this.urlOutput = encodeURIComponent(this.urlInput);
                } catch (e) {
                    this.urlOutput = "编码错误: " + e.message;
                }
            },
            doUrlDecode() {
                try {
                    this.urlOutput = decodeURIComponent(this.urlInput);
                } catch (e) {
                    this.urlOutput = "解码错误: 输入不是有效的 URL 编码";
                }
            },
            doBase64Encode() {
                this.base64Error = '';
                if (!this.base64Left) return;
                try {
                    // 使用 CryptoJS 处理中文，避免乱码
                    if (window.CryptoJS) {
                        let wordArray = CryptoJS.enc.Utf8.parse(this.base64Left);
                        this.base64Right = CryptoJS.enc.Base64.stringify(wordArray);
                    } else {
                        // 降级方案
                        this.base64Right = window.btoa(unescape(encodeURIComponent(this.base64Left)));
                    }
                } catch (e) {
                    this.base64Error = "编码失败: " + e.message;
                }
            },
            doBase64Decode() {
                this.base64Error = '';
                if (!this.base64Right) return;
                try {
                    if (window.CryptoJS) {
                        let parsedWordArray = CryptoJS.enc.Base64.parse(this.base64Right);
                        this.base64Left = parsedWordArray.toString(CryptoJS.enc.Utf8);
                    } else {
                        this.base64Left = decodeURIComponent(escape(window.atob(this.base64Right)));
                    }
                    if (!this.base64Left && this.base64Right) {
                        this.base64Error = "解码结果为空，请检查 Base64 格式是否正确";
                    }
                } catch (e) {
                    this.base64Error = "解码失败: 无效的 Base64 字符串";
                }
            },
            clearBase64() {
                this.base64Left = '';
                this.base64Right = '';
                this.base64Error = '';
            },
            copyToClip(content) {
                // 转为字符串，防止数字报错
                const text = String(content);

                if (navigator.clipboard) {
                    // 现代浏览器 API
                    navigator.clipboard.writeText(text).then(() => {
                        // 这里可以使用一个轻提示，或者简单的 alert
                        // 为了体验好，建议做一个 toast，这里简单演示用 alert 或控制台
                        // alert("复制成功: " + text);
                        this.showToast("复制成功: " + text); // 建议实现下面的 showToast
                    }).catch(err => {
                        console.error('复制失败', err);
                    });
                } else {
                    // 兼容旧浏览器
                    const textarea = document.createElement('textarea');
                    textarea.value = text;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    this.showToast("复制成功: " + text);
                }
            },
            showToast(msg) {
                // 创建一个临时 div 显示提示
                let toast = document.createElement('div');
                toast.innerText = msg;
                toast.style.position = 'fixed';
                toast.style.top = '20px';
                toast.style.left = '50%';
                toast.style.transform = 'translateX(-50%)';
                toast.style.background = 'rgba(0,0,0,0.7)';
                toast.style.color = '#fff';
                toast.style.padding = '10px 20px';
                toast.style.borderRadius = '4px';
                toast.style.zIndex = '9999';
                toast.style.fontSize = '14px';
                document.body.appendChild(toast);
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 2000);
            }
        }
    });
</script>
</body>
</html>